<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZAIN NETWORK v51</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlpBSU4gTkVUV09SSyIsCiAgInNob3J0X25hbWUiOiAiWkFJTml0IiwKICAic3RhcnRfdXJsIjogIi4vIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMjAwOTNlIiwKICAidGhlbWVfY29sb3IiOiAiIzYxMzE5ZCJ9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.2.2.min.js"></script>
    <style>
        :root { 
            --bg: #20093e; --card: #301654; --accent: #9b59b6; --text: #fff;
            --gold: #d4af37; --green: #52b788; --red: #e63946;
        }
        /* Ù…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙ… ÙˆØªØ­Ø³ÙŠÙ† Ø§Ù„Ù„Ù…Ø³ */
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; font-size: 16px; }

        /* Ø§Ù„Ø«ÙŠÙ…Ø§Øª */
        body.theme-black { --bg: #000; --card: #1a1a1a; --accent: #333; }
        body.theme-gold { --bg: #1a1a1a; --card: #2c2c2c; --accent: #d4af37; }
        body.theme-white { --bg: #f0f0f0; --card: #fff; --accent: #9b59b6; --text: #333; }
        body.theme-red { --bg: #4a0000; --card: #600000; --accent: #ff4d4d; }

        /* Ù…Ù†Ø¹ ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø© Ø¹Ù†Ø¯ Ø§Ù„ÙƒØªØ§Ø¨Ø© ÙÙŠ Ø§Ù„Ø£ÙŠÙÙˆÙ† */
        input, select, textarea { font-size: 16px !important; background: rgba(0,0,0,0.3) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: inherit !important; padding: 15px; border-radius: 20px; outline: none; width: 100%; }
        
        .sidebar { width: 320px; background: var(--bg); height: 100vh; position: fixed; right: 0; transition: 0.4s; z-index: 1000; padding: 20px; border-left: 1px solid rgba(255,255,255,0.05); overflow-y: auto; }
        .sidebar.hidden { transform: translateX(100%); }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ±Ø© */
        .settings-panel { display: none; background: var(--card); border-radius: 35px; padding: 30px; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .settings-panel.active { display: block; }

        /* ØªØµÙ…ÙŠÙ… Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù…Ø·ÙˆØ± */
        .msg-container { display: flex; gap: 10px; margin-bottom: 20px; align-self: flex-start; max-width: 85%; }
        .msg-container.mine { align-self: flex-end; flex-direction: row-reverse; }
        .msg-avatar { width: 40px; height: 40px; border-radius: 12px; object-fit: cover; border: 2px solid var(--accent); }
        .msg-content { background: var(--card); padding: 12px 16px; border-radius: 20px; position: relative; }
        .mine .msg-content { background: var(--accent); color: white; }
        .msg-info { font-size: 0.7rem; font-weight: 800; margin-bottom: 4px; display: flex; justify-content: space-between; gap: 10px; opacity: 0.7; }

        /* Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ØµØ¯Ù‚Ø§Ø¡ */
        .friend-card { background: var(--card); padding: 15px; border-radius: 22px; margin-bottom: 12px; display: flex; align-items: center; gap: 10px; }
        .action-btn { background: rgba(0,0,0,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 10px; cursor: pointer; }

        .btn-main { background: var(--accent); color: white; border: none; padding: 18px; border-radius: 22px; width: 100%; font-weight: 800; margin-bottom: 15px; cursor: pointer; }
        .btn-green { background: var(--green); color: white; border: none; padding: 18px; border-radius: 22px; width: 100%; font-weight: 800; cursor: pointer; margin-bottom: 10px; }
        
        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø© */
        .link-result { background: rgba(0,0,0,0.2); border-radius: 15px; padding: 15px; margin-top: 10px; display: none; }
        
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; padding-top: 85px; }
        .input-bar { padding: 20px; background: var(--bg); display: flex; gap: 10px; padding-bottom: env(safe-area-inset-bottom, 25px); }
    </style>
</head>
<body id="bodyTag">

<div id="lockScreen" style="position:fixed; inset:0; background:var(--bg); z-index:5000; display:flex; align-items:center; justify-content:center; text-align:center;">
    <div style="background:var(--card); padding:40px; border-radius:35px; width:90%; max-width:380px;">
        <h1 style="color:var(--accent); font-weight:900;">ZAIN NET</h1>
        <input type="password" id="passInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„">
        <button onclick="unlock()" class="btn-main" style="margin-top:20px;">Ø¯Ø®ÙˆÙ„</button>
    </div>
</div>

<button id="toggleBtn" class="menu-btn" style="position:fixed; top:25px; left:25px; z-index:2000; background:var(--accent); color:white; width:45px; height:45px; border-radius:15px; border:none; display:none;" onclick="toggleSidebar()">â˜°</button>

<div class="sidebar" id="sidebar">
    <div id="mainSidebarView">
        <div style="text-align:center; margin-bottom:25px;">
            <img id="myPfp" src="" style="width:80px; height:80px; border-radius:25px; border:3px solid var(--accent);">
            <div id="myName" style="font-weight:800; font-size:1.4rem;"></div>
            <div id="myIDDisplay" style="font-size:0.8rem; opacity:0.5;"></div>
            <button onclick="showSettings()" class="btn-main" style="padding:8px; margin-top:10px; font-size:0.9rem;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</button>
        </div>

        <button onclick="addNewFriend()" class="btn-main">â• Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚</button>
        <div id="friendsList"></div>

        <button class="btn-green" onclick="document.getElementById('fileIn').click()">ğŸ“¥ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø§Ø¨Ø· Ù…Ù„Ù</button>
        <input type="file" id="fileIn" hidden onchange="handleFileUpload(this)">
        
        <div id="linkOutput" class="link-result">
            <div style="font-size:0.7rem; opacity:0.6; margin-bottom:5px;">Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬:</div>
            <input type="text" id="finalLink" readonly style="padding:8px; font-size:0.7rem !important;">
            <button onclick="copyLink()" class="btn-main" style="padding:10px; margin-top:8px; font-size:0.8rem; background:var(--green);">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
        </div>

        <button onclick="location.reload()" class="btn-main" style="background:var(--red); margin-top:20px;">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>

    <div id="settingsPanel" class="settings-panel">
        <h2 style="color:var(--accent); font-size:1.5rem; text-align:center;">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
        <div style="display:flex; flex-direction:column; gap:12px;">
            <input type="text" id="editN" placeholder="Ø§Ù„Ø§Ø³Ù…">
            <input type="text" id="editP" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
            <input type="password" id="editPass" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯">
            <select id="editT" onchange="changeTheme(this.value)">
                <option value="default">ğŸŸ£ Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
                <option value="black">âš« Ø£Ø³ÙˆØ¯ Ù…Ù„ÙƒÙŠ</option>
                <option value="gold">ğŸŸ¡ Ø°Ù‡Ø¨ÙŠ</option>
                <option value="white">âšª Ø£Ø¨ÙŠØ¶</option>
                <option value="red">ğŸ”´ Ø£Ø­Ù…Ø±</option>
            </select>
            <button onclick="saveProfile()" class="btn-main" style="margin-bottom:5px;">Ø­ÙØ¸</button>
            <button onclick="hideSettings()" style="background:rgba(255,255,255,0.05); color:inherit; border:none; padding:15px; border-radius:20px;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>
</div>

<div style="flex:1; display:flex; flex-direction:column; position:relative;">
    <div id="messages"></div>
    <div class="input-bar">
        <input type="text" id="msgIn" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ..." onkeypress="if(event.key==='Enter') send()">
        <button onclick="send()" style="background:var(--accent); border:none; color:white; padding:0 25px; border-radius:18px; font-weight:bold;">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<script>
    let pubnub, myID = localStorage.getItem('zain_id') || Math.floor(Math.random()*899)+100;
    localStorage.setItem('zain_id', myID);
    let friends = JSON.parse(localStorage.getItem('my_friends_v2') || "[]"), currentFid = null;

    function changeTheme(theme) {
        document.getElementById('bodyTag').className = theme === 'default' ? '' : 'theme-' + theme;
        localStorage.setItem('zain_theme', theme);
    }
    changeTheme(localStorage.getItem('zain_theme') || 'default');

    function unlock() {
        if(document.getElementById('passInput').value !== (localStorage.getItem('my_pass') || "123")) return alert("Ø®Ø·Ø£");
        document.getElementById('lockScreen').style.display = 'none';
        document.getElementById('toggleBtn').style.display = 'block';
        initPN(); loadUI(); renderFriends();
    }

    function initPN() {
        pubnub = new PubNub({ publishKey: "pub-c-90243370-fb67-4c9c-914f-77acbcade771", subscribeKey: "sub-c-bc8811a4-c349-4df5-8896-9a7cf29ad727", uuid: myID.toString() });
        pubnub.addListener({ message: (m) => { 
            if(m.channel.includes(currentFid)) renderMsg(m.message);
            else if(m.message.uid != myID) new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg').play().catch(()=>{});
        }});
        friends.forEach(f => pubnub.subscribe({ channels: ["v8_chat_" + [myID, f.id].sort().join("_")] }));
    }

    function parseMedia(text) {
        const imgReg = /(https?:\/\/.*\.(?:png|jpg|jpeg|gif|webp))/i;
        const vidReg = /(https?:\/\/.*\.(?:mp4|webm|mov))/i;
        const ytReg = /(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/;
        let html = `<div>${text}</div><div style="margin-top:8px;">`;
        if(imgReg.test(text)) html += `<img src="${text.match(imgReg)[0]}" style="max-width:100%; border-radius:15px;">`;
        if(vidReg.test(text)) html += `<video controls src="${text.match(vidReg)[0]}" style="max-width:100%; border-radius:15px;"></video>`;
        if(ytReg.test(text)) html += `<iframe width="100%" height="200" src="https://www.youtube.com/embed/${text.match(ytReg)[1]}" frameborder="0" allowfullscreen style="border-radius:15px;"></iframe>`;
        return html + `</div>`;
    }

    function renderMsg(data) {
        const box = document.getElementById('messages'), isMine = data.uid == myID;
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        const div = document.createElement('div');
        div.className = `msg-container ${isMine ? 'mine' : ''}`;
        div.innerHTML = `
            <img src="${data.pic || 'https://www.gravatar.com/avatar/'+data.uid+'?d=identicon'}" class="msg-avatar">
            <div class="msg-content">
                <div class="msg-info"><span>${data.name}</span><span>${time}</span></div>
                ${parseMedia(data.text)}
            </div>`;
        box.appendChild(div); box.scrollTop = box.scrollHeight;
    }

    function renderFriends() {
        const list = document.getElementById('friendsList'); list.innerHTML = "";
        friends.forEach((f, i) => {
            const div = document.createElement('div'); div.className = `friend-card ${currentFid == f.id ? 'active' : ''}`;
            div.innerHTML = `
                <img src="https://www.gravatar.com/avatar/${f.id}?d=identicon" style="width:40px; height:40px; border-radius:50%;">
                <div style="flex:1;" onclick="openChat('${f.id}')"><b>${f.name}</b></div>
                <button class="action-btn" onclick="editFriend(${i})">âœï¸</button>
                <button class="action-btn" onclick="deleteFriend(${i})" style="color:var(--red)">âœ•</button>`;
            list.appendChild(div);
        });
    }

    function handleFileUpload(input) {
        if (!input.files[0]) return;
        const reader = new FileReader();
        reader.onload = (e) => {
            document.getElementById('linkOutput').style.display = 'block';
            document.getElementById('finalLink').value = e.target.result.substring(0, 100) + "...(Base64)"; 
            // Ù…Ù„Ø§Ø­Ø¸Ø©: Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ ÙŠÙØ¶Ù„ Ø±ÙØ¹Ù‡Ø§ Ù„Ø³ÙŠØ±ÙØ±ØŒ Ù‡Ù†Ø§ Ù…Ø¬Ø±Ø¯ Ù…Ø­Ø§ÙƒØ§Ø© Ù„Ù„Ø±Ø§Ø¨Ø·
        };
        reader.readAsDataURL(input.files[0]);
    }

    function copyLink() {
        const copyText = document.getElementById("finalLink");
        copyText.select();
        document.execCommand("copy");
        alert("ØªÙ… Ø§Ù„Ù†Ø³Ø®!");
    }

    function showSettings() { document.getElementById('mainSidebarView').style.display = 'none'; document.getElementById('settingsPanel').classList.add('active'); }
    function hideSettings() { document.getElementById('mainSidebarView').style.display = 'block'; document.getElementById('settingsPanel').classList.remove('active'); }

    function saveProfile() {
        const n = document.getElementById('editN').value;
        const p = document.getElementById('editP').value;
        const pass = document.getElementById('editPass').value;
        if(n) localStorage.setItem('zain_name', n);
        if(p) localStorage.setItem('zain_pic', p);
        if(pass) localStorage.setItem('my_pass', pass);
        location.reload();
    }

    function openChat(id) {
        currentFid = id; renderFriends();
        pubnub.history({ channel: "v8_chat_" + [myID, id].sort().join("_"), count: 50 }, (s, res) => {
            document.getElementById('messages').innerHTML = "";
            if (res.messages) res.messages.forEach(m => renderMsg(m.entry));
        });
        if(window.innerWidth < 600) toggleSidebar();
    }

    function send() {
        const inp = document.getElementById('msgIn'); if(!inp.value.trim() || !currentFid) return;
        pubnub.publish({ channel: "v8_chat_" + [myID, currentFid].sort().join("_"), message: { 
            text: inp.value, uid: myID, name: localStorage.getItem('zain_name') || "Ù…Ø³ØªØ®Ø¯Ù…", pic: localStorage.getItem('zain_pic') 
        }});
        inp.value = "";
    }

    function addNewFriend() {
        const id = prompt("ID Ø§Ù„ØµØ¯ÙŠÙ‚:"); const name = prompt("Ø§Ù„Ø§Ø³Ù…:");
        if(id && name) { friends.push({id, name}); localStorage.setItem('my_friends_v2', JSON.stringify(friends)); renderFriends(); }
    }

    function editFriend(i) { const n = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…:", friends[i].name); if(n) { friends[i].name = n; renderFriends(); }}
    function deleteFriend(i) { if(confirm("Ø­Ø°ÙØŸ")) { friends.splice(i,1); renderFriends(); }}
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('hidden'); }
    function loadUI() {
        document.getElementById('myName').innerText = localStorage.getItem('zain_name') || "ZAIN USER";
        document.getElementById('myIDDisplay').innerText = "ID: " + myID;
        document.getElementById('myPfp').src = localStorage.getItem('zain_pic') || "https://www.gravatar.com/avatar/" + myID + "?d=identicon";
        document.getElementById('editN').value = localStorage.getItem('zain_name') || "";
        document.getElementById('editP').value = localStorage.getItem('zain_pic') || "";
    }
</script>
</body>
</html>
