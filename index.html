<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZAIN NETWORK v56</title>
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlpBSU4gTkVUV09SSyIsCiAgInNob3J0X25hbWUiOiAiWkFJTml0IiwKICAic3RhcnRfdXJsIjogIi4vIiwKICAiZGlzcGxheSI6ICJzdGFuZGFsb25lIiwKICAiaWNvbnMiOiBbIHsgInNyYyI6ICJodHRwczovL2Nkbi1pY29ucy1wbmcuZmxhdGljb24uY29tLzUxMi81OTY4LzU5Njg4NzUucG5nIiwgInNpemVzIjogIjUxMng1MTIiLCAidHlwZSI6ICJpbWFnZS9wbmciIH0gXQp9">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.2.2.min.js"></script>
    <style>
        :root { 
            --bg: #313338; --side: #2b2d31; --accent: #5865f2; 
            --text: #dbdee1; --msg-bg: #383a40; --input-bg: rgba(0,0,0,0.2);
        }
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; transition: background 0.3s; }
        input, select { background: var(--input-bg) !important; border: 1px solid rgba(255,255,255,0.1) !important; color: var(--text) !important; padding: 15px; border-radius: 15px; outline: none; width: 100%; font-size: 15px; }
        #chatWall { position: absolute; inset: 0; background-size: cover; background-position: center; opacity: 0.2; z-index: -1; pointer-events: none; }
        .sidebar { width: 300px; background: var(--side); height: 100vh; display: flex; flex-direction: column; position: fixed; right: 0; transition: 0.4s; z-index: 1000; border-left: 1px solid rgba(0,0,0,0.2); }
        .sidebar.hidden { transform: translateX(100%); }
        .main-content { flex: 1; display: flex; flex-direction: column; width: 100vw; height: 100vh; position: relative; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 18px; padding-top: 85px; }
        .msg { max-width: 80%; padding: 14px 18px; border-radius: 20px; background: var(--msg-bg); align-self: flex-start; display: flex; gap: 12px; line-height: 1.6; box-shadow: 0 4px 15px rgba(0,0,0,0.1); border: 1px solid rgba(255,255,255,0.03); }
        .msg.mine { align-self: flex-end; background: var(--accent); color: white; flex-direction: row-reverse; }
        .msg img, .msg video { max-width: 100%; max-height: 350px; border-radius: 12px; margin-top: 8px; object-fit: contain; display: block; }
        .friend-card { background: rgba(255,255,255,0.03); padding: 12px; border-radius: 15px; margin-bottom: 10px; cursor: pointer; display: flex; align-items: center; gap: 12px; border: 1px solid transparent; }
        .friend-card.active { border-color: var(--accent); background: rgba(88, 101, 242, 0.15); }
        .btn-action { width: 100%; padding: 14px; border: none; border-radius: 15px; font-weight: 800; cursor: pointer; margin-bottom: 12px; color: white; }
        .input-bar { padding: 20px; background: var(--side); display: flex; gap: 12px; border-top: 1px solid rgba(0,0,0,0.1); padding-bottom: env(safe-area-inset-bottom, 25px); }
        .avatar { width: 48px; height: 48px; border-radius: 16px; object-fit: cover; border: 2px solid var(--accent); }
        .toggle-btn { position: fixed; top: 20px; left: 20px; z-index: 2000; background: var(--accent); border: none; color: white; width: 50px; height: 50px; border-radius: 15px; cursor: pointer; }
        .badge { position: absolute; top: -5px; right: -5px; background: #ed4245; color: white; font-size: 11px; font-weight: bold; min-width: 20px; height: 20px; border-radius: 10px; display: none; align-items: center; justify-content: center; border: 2px solid var(--side); }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 6000; align-items: center; justify-content: center; }
        .modal-content { background: var(--side); padding: 30px; border-radius: 25px; width: 90%; max-width: 400px; }
    </style>
</head>
<body>

<div id="lockScreen" style="position:fixed; inset:0; background:var(--bg); z-index:5000; display:flex; align-items:center; justify-content:center; backdrop-filter: blur(10px);">
    <div style="text-align:center; background:var(--side); padding:40px; border-radius:30px; width:85%; max-width:380px;">
        <h1 style="color:var(--accent); margin:0; font-size:2rem; font-weight:900;">ZAIN NET</h1>
        <p style="opacity:0.5; font-size:0.9rem; margin-bottom:30px;">V56 | Secure Workspace</p>
        <input type="password" id="passInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ù…Ø±ÙˆØ±" onkeypress="if(event.key==='Enter') unlock()">
        <button onclick="unlock()" style="background:var(--accent); color:white; border:none; padding:16px; width:100%; border-radius:15px; margin-top:20px; font-weight:bold;">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</button>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <h2 style="color:var(--accent); margin-bottom:20px;">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2>
        <div style="display:flex; flex-direction:column; gap:15px;">
            <input type="text" id="newN" placeholder="Ø§Ù„Ø§Ø³Ù…">
            <input type="text" id="newP" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±ØªÙƒ">
            <input type="text" id="newWall" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„Ø®Ù„ÙÙŠØ©">
            <input type="password" id="newPass" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯">
            <select id="newT">
                <option value="default">ğŸ”µ Ø¯ÙŠÙÙˆÙ„Øª</option>
                <option value="white">âšª Ø£Ø¨ÙŠØ¶</option>
                <option value="purple">ğŸŸ£ Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
                <option value="gold">ğŸ‘‘ Ø°Ù‡Ø¨ÙŠ</option>
                <option value="black">âš« Ø£Ø³ÙˆØ¯ Ù…Ù„ÙƒÙŠ</option>
            </select>
            <div style="display:flex; gap:10px; margin-top:10px;">
                <button onclick="saveSettings()" style="background:var(--accent); color:white; border:none; padding:15px; flex:1; border-radius:12px; font-weight:bold;">Ø­ÙØ¸</button>
                <button onclick="closeSettings()" style="background:rgba(255,255,255,0.05); color:var(--text); border:none; padding:15px; flex:1; border-radius:12px;">Ø¥Ù„ØºØ§Ø¡</button>
            </div>
        </div>
    </div>
</div>

<button id="toggleBtn" class="toggle-btn" style="display:none;" onclick="toggleSidebar()">
    â˜°
    <div id="badgeCount" class="badge">0</div>
</button>

<div class="sidebar" id="sidebar">
    <div style="padding:30px; text-align:center; border-bottom:1px solid rgba(255,255,255,0.05);">
        <img id="myPfp" src="" class="avatar" style="width:70px; height:70px; margin-bottom:10px;">
        <div id="myName" style="font-weight:800; font-size:1.2rem; line-height:1;"></div>
        <div id="myIDDisplay" style="font-size:0.75rem; opacity:0.5; margin-top:4px; font-weight:bold;"></div>
        <button onclick="openSettings()" style="background:rgba(88,101,242,0.1); border:1px solid var(--accent); color:var(--accent); font-size:0.75rem; padding:6px 15px; border-radius:20px; margin-top:12px;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„</button>
    </div>
    <div style="flex:1; overflow-y:auto; padding:20px;">
        <button onclick="addNewFriend()" class="btn-action" style="background:var(--accent);">â• Ø¥Ø¶Ø§ÙØ© ØµØ¯ÙŠÙ‚</button>
        <button onclick="activateNotifs()" class="btn-action" style="background:#ff9f1c;">ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</button>
        
        <div id="friendsList"></div>
        <div style="margin-top:25px; padding-top:20px; border-top:1px solid rgba(255,255,255,0.05);">
            <button onclick="document.getElementById('fastUpload').click()" class="btn-action" style="background:#43b581;">ğŸ“¤ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø§Ø¨Ø· Ù…Ù„Ù</button>
            <input type="file" id="fastUpload" style="display:none" onchange="generateLink(this)">
            <div id="linkBoxContainer" style="display:none; background:rgba(0,0,0,0.3); padding:10px; border-radius:15px; border:1px dashed var(--accent);">
                <input type="text" id="generatedLinkInput" readonly style="margin-bottom:8px; font-size:0.7rem;">
                <button onclick="copyGeneratedLink()" style="background:var(--accent); color:white; border:none; width:100%; padding:8px; border-radius:10px; font-weight:bold;">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
            </div>
        </div>
    </div>
    <div style="padding:20px;">
        <button onclick="location.reload()" class="btn-action" style="background:#ed4245;">ğŸšª ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
    </div>
</div>

<div class="main-content">
    <div id="chatWall"></div>
    <div id="messages"></div>
    <div class="input-bar">
        <input type="text" id="msgIn" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©..." onkeypress="if(event.key==='Enter') send()">
        <button onclick="send()" style="background:var(--accent); color:white; border:none; padding:0 30px; border-radius:15px; font-weight:bold;">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<script>
    let unreadCount = 0;

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø²Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
    async function activateNotifs() {
        if (!("Notification" in window)) {
            alert("Ù‡Ø°Ø§ Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª");
            return;
        }
        const permission = await Notification.requestPermission();
        if (permission === "granted") {
            alert("ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­ âœ…");
            new Notification("ZAIN NET", { body: "Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ØªØ¹Ù…Ù„ Ø§Ù„Ø¢Ù†!" });
        } else {
            alert("ÙŠØ¬Ø¨ Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…ØªØµÙØ­/Ø§Ù„Ø£ÙŠÙÙˆÙ† âŒ");
        }
    }

    function showBrowserNotification(title, body, icon) {
        if ("Notification" in window && Notification.permission === "granted") {
            new Notification(title, { body: body, icon: icon || 'https://cdn-icons-png.flaticon.com/512/5968/5968875.png' });
            if (navigator.vibrate) navigator.vibrate(200);
        }
    }

    function updateBadge(count) {
        unreadCount = count;
        const badgeEl = document.getElementById('badgeCount');
        if (count > 0) {
            badgeEl.innerText = count;
            badgeEl.style.display = 'flex';
            if ('setAppBadge' in navigator) navigator.setAppBadge(count).catch(() => {});
        } else {
            badgeEl.style.display = 'none';
            if ('clearAppBadge' in navigator) navigator.clearAppBadge().catch(() => {});
        }
    }

    function applySettings() {
        const theme = localStorage.getItem('zain_theme') || 'default';
        const themes = {
            default: { bg: "#313338", side: "#2b2d31", accent: "#5865f2", text: "#dbdee1", msg: "#383a40", input: "rgba(0,0,0,0.2)" },
            white: { bg: "#f0f2f5", side: "#ffffff", accent: "#007bff", text: "#1c1e21", msg: "#e4e6eb", input: "#fff" },
            purple: { bg: "#1e0b36", side: "#2d134d", accent: "#9d50bb", text: "#efdaff", msg: "#3c1b66", input: "rgba(0,0,0,0.3)" },
            gold: { bg: "#1a1a1a", side: "#262626", accent: "#d4af37", text: "#f2f2f2", msg: "#333333", input: "rgba(0,0,0,0.3)" },
            black: { bg: "#000000", side: "#0a0a0a", accent: "#ffffff", text: "#ffffff", msg: "#1a1a1a", input: "#111" }
        };
        const t = themes[theme] || themes.default;
        const r = document.documentElement;
        r.style.setProperty('--bg', t.bg); r.style.setProperty('--side', t.side);
        r.style.setProperty('--accent', t.accent); r.style.setProperty('--text', t.text);
        r.style.setProperty('--msg-bg', t.msg); r.style.setProperty('--input-bg', t.input);
        if(localStorage.getItem('zain_wall')) document.getElementById('chatWall').style.backgroundImage = `url(${localStorage.getItem('zain_wall')})`;
    }
    applySettings();

    let pubnub, myID = localStorage.getItem('zain_id') || Math.floor(Math.random()*8999)+1000;
    localStorage.setItem('zain_id', myID);
    let friends = JSON.parse(localStorage.getItem('my_friends_v2') || "[]"), currentFid = null;

    function unlock() {
        if(document.getElementById('passInput').value !== (localStorage.getItem('my_pass') || "123")) return alert("âŒ Ø§Ù„Ø±Ù…Ø² Ø®Ø·Ø£");
        document.getElementById('lockScreen').style.display = 'none';
        document.getElementById('toggleBtn').style.display = 'block';
        initPN(); loadUI(); renderFriends();
    }

    function initPN() {
        pubnub = new PubNub({ publishKey: "pub-c-90243370-fb67-4c9c-914f-77acbcade771", subscribeKey: "sub-c-bc8811a4-c349-4df5-8896-9a7cf29ad727", uuid: myID.toString() });
        pubnub.addListener({ message: (m) => { 
            if(m.channel.includes(currentFid)) {
                renderMsg(m.message);
            } else if(m.message.uid != myID) {
                updateBadge(unreadCount + 1);
                showBrowserNotification(m.message.name, m.message.text, m.message.pic);
            }
        }});
        friends.forEach(f => pubnub.subscribe({ channels: ["v8_chat_" + [myID, f.id].sort().join("_")] }));
    }

    function renderMsg(data) {
        if(!data.uid) return;
        const box = document.getElementById('messages'), isMine = data.uid == myID, div = document.createElement('div');
        div.className = `msg ${isMine ? 'mine' : ''}`;
        let content = data.text || "";
        if(content.includes('youtube.com/') || content.includes('youtu.be/')) {
            const id = content.match(/(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|&v=|shorts\/))([^#&?]*)/);
            if(id) content = `<iframe style="width:100%; aspect-ratio:16/9; border:none; border-radius:10px;" src="https://www.youtube.com/embed/${id[1]}" allowfullscreen></iframe>`;
        } else if(content.match(/\.(jpg|jpeg|png|gif|webp)/i)) content = `<img src="${content}">`;
        else if(content.match(/\.(mp4|mov|webm)/i)) content = `<video controls src="${content}"></video>`;
        div.innerHTML = `<img src="${data.pic || 'https://www.gravatar.com/avatar/'+data.uid+'?d=identicon'}" class="avatar" style="width:35px; height:35px;"><div style="flex:1;"><div style="font-size:0.65rem; font-weight:800; opacity:0.8; margin-bottom:4px;">${data.name}</div><div style="white-space: pre-wrap; word-break: break-word;">${content}</div></div>`;
        box.appendChild(div); box.scrollTop = box.scrollHeight;
    }

    function send() {
        const inp = document.getElementById('msgIn'); if(!inp.value.trim() || !currentFid) return;
        pubnub.publish({ channel: "v8_chat_" + [myID, currentFid].sort().join("_"), message: { text: inp.value, uid: myID, name: document.getElementById('myName').innerText, pic: localStorage.getItem('zain_pic') } });
        inp.value = "";
    }

    function openChat(id) {
        currentFid = id; renderFriends(); document.getElementById('messages').innerHTML = "";
        updateBadge(0);
        if(window.innerWidth < 600) toggleSidebar();
        const chan = "v8_chat_" + [myID, id].sort().join("_");
        pubnub.fetchMessages({ channels: [chan], count: 50 }, (s, res) => { if (res && res.channels[chan]) res.channels[chan].forEach(m => renderMsg(m.message)); });
    }

    function renderFriends() {
        const list = document.getElementById('friendsList'); list.innerHTML = "";
        friends.forEach(f => {
            const div = document.createElement('div'); div.className = `friend-card ${currentFid == f.id ? 'active' : ''}`;
            div.innerHTML = `<img src="https://www.gravatar.com/avatar/${f.id}?d=identicon" class="avatar" style="width:35px; height:35px;"> <span style="font-weight:bold;">${f.name}</span> <div style="margin-right:auto; opacity:0.6;"><span onclick="removeFriend('${f.id}', event)">âœ•</span></div>`;
            div.onclick = () => openChat(f.id); list.appendChild(div);
        });
    }

    async function generateLink(input) {
        const file = input.files[0]; if(!file) return;
        try {
            const up = await pubnub.sendFile({ channel: "vault_" + myID, file: file });
            const url = pubnub.getFileUrl({ channel: "vault_" + myID, id: up.id, name: up.name });
            document.getElementById('generatedLinkInput').value = url;
            document.getElementById('linkBoxContainer').style.display = 'block';
        } catch(e) { alert("âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø±ÙØ¹"); }
    }

    function addNewFriend() {
        const id = prompt("ID Ø§Ù„ØµØ¯ÙŠÙ‚:");
        if(id) { const name = prompt("Ø§Ù„Ø§Ø³Ù…:") || "ØµØ¯ÙŠÙ‚"; friends.push({id, name}); localStorage.setItem('my_friends_v2', JSON.stringify(friends)); renderFriends(); }
    }
    function removeFriend(id, e) { e.stopPropagation(); if(confirm("Ø­Ø°ÙØŸ")) { friends = friends.filter(x => x.id != id); localStorage.setItem('my_friends_v2', JSON.stringify(friends)); renderFriends(); } }
    function openSettings() { document.getElementById('settingsModal').style.display = 'flex'; }
    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }
    function saveSettings() {
        localStorage.setItem('zain_name', document.getElementById('newN').value);
        localStorage.setItem('zain_pic', document.getElementById('newP').value);
        localStorage.setItem('zain_wall', document.getElementById('newWall').value);
        localStorage.setItem('zain_theme', document.getElementById('newT').value);
        localStorage.setItem('my_pass', document.getElementById('newPass').value);
        location.reload();
    }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('hidden'); }
    function copyGeneratedLink() { document.getElementById('generatedLinkInput').select(); document.execCommand('copy'); alert("ØªÙ… Ø§Ù„Ù†Ø³Ø® âœ…"); }
    function loadUI() {
        document.getElementById('myName').innerText = localStorage.getItem('zain_name') || "Ù…Ø³ØªØ®Ø¯Ù… #" + myID;
        document.getElementById('myPfp').src = localStorage.getItem('zain_pic') || "https://www.gravatar.com/avatar/" + myID + "?d=identicon";
        document.getElementById('myIDDisplay').innerText = "ID: " + myID;
    }
</script>
</body>
</html>
