<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ZAIN NETWORK v37</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.2.2.min.js"></script>
    <style>
        /* Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ© */
        :root { --bg: #313338; --side: #2b2d31; --accent: #5865f2; --text: #dbdee1; --msg-bg: #383a40; }
        
        * { box-sizing: border-box; font-family: 'Cairo', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); height: 100vh; overflow: hidden; display: flex; overscroll-behavior-y: contain; transition: background 0.3s ease; }
        
        /* Ø´Ø§Ø´Ø© Ø§Ù„Ù‚ÙÙ„ - ØªØªØ£Ø«Ø± Ø¨Ø§Ù„Ø«ÙŠÙ… Ø§Ù„Ø¢Ù† */
        .lock-screen { position: fixed; inset: 0; background: var(--bg); z-index: 5000; display: flex; align-items: center; justify-content: center; }
        .lock-box { text-align: center; background: var(--side); padding: 35px; border-radius: 25px; width: 85%; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.05); }

        #chatWall { position: absolute; inset: 0; background-size: cover; background-position: center; opacity: 0.3; z-index: -1; pointer-events: none; }

        .sidebar { width: 300px; background: var(--side); height: 100vh; display: flex; flex-direction: column; position: fixed; right: 0; transition: 0.4s ease; z-index: 1000; border-left: 1px solid rgba(0,0,0,0.1); }
        .sidebar.hidden { transform: translateX(100%); }
        
        .main-content { flex: 1; display: flex; flex-direction: column; width: 100vw; height: 100vh; position: relative; }
        #messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; padding-top: 80px; word-break: break-word; }

        .msg { max-width: 85%; padding: 12px 16px; border-radius: 18px; background: var(--msg-bg); align-self: flex-start; display: flex; gap: 12px; }
        .msg.mine { align-self: flex-end; background: var(--accent); color: white; flex-direction: row-reverse; }

        .friend-card { background: var(--msg-bg); padding: 12px; border-radius: 12px; margin-bottom: 8px; cursor: pointer; display: flex; align-items: center; gap: 10px; position: relative; }
        .friend-card.active { border: 2px solid var(--accent); background: rgba(88, 101, 242, 0.1); }
        
        .input-bar { padding: 15px; background: var(--side); display: flex; gap: 10px; padding-bottom: env(safe-area-inset-bottom, 25px); }
        input, select { padding: 14px; border-radius: 12px; border: none; background: rgba(0,0,0,0.15); color: inherit; outline: none; width: 100%; font-size: 16px; border: 1px solid rgba(255,255,255,0.05); }
        
        .toggle-btn { position: fixed; top: 15px; left: 15px; z-index: 2000; background: var(--accent); border: none; color: white; width: 45px; height: 45px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 6000; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(5px); }
        .modal-content { background: var(--side); padding: 25px; border-radius: 20px; width: 100%; max-width: 400px; max-height: 90vh; overflow-y: auto; color: var(--text); }

        .avatar { width: 45px; height: 45px; border-radius: 14px; object-fit: cover; border: 1px solid var(--accent); }
        img, video { max-width: 100%; border-radius: 12px; margin-top: 5px; }
        .tool-btn { cursor: pointer; opacity: 0.7; transition: 0.2s; }
        .tool-btn:hover { opacity: 1; transform: scale(1.1); }
    </style>
</head>
<body>

<div id="lockScreen" class="lock-screen">
    <div class="lock-box">
        <h1 style="color:var(--accent); font-weight:900; margin-bottom:10px;">ZAIN NET</h1>
        <p style="font-size:0.8rem; opacity:0.6; margin-bottom:20px;">Ø§Ù„Ø¥ØµØ¯Ø§Ø± v37 - Ø¢Ù…Ù† ÙˆÙ…Ø´ÙØ±</p>
        <input type="password" id="passInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø´Ø®ØµÙŠ" onkeypress="if(event.key==='Enter') unlock()">
        <button onclick="unlock()" style="background:var(--accent); color:white; border:none; padding:15px; width:100%; border-radius:12px; margin-top:15px; font-weight:bold; cursor:pointer;">Ø¯Ø®ÙˆÙ„ Ø¢Ù…Ù†</button>
    </div>
</div>

<div id="settingsModal" class="modal">
    <div class="modal-content">
        <h3 style="color:var(--accent); margin:0 0 20px 0;">âš™ï¸ ØªØ®ØµÙŠØµ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3>
        
        <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ø±Ø¶:</label>
        <input type="text" id="newN" placeholder="Ø§Ø³Ù…Ùƒ">
        
        <label style="display:block; margin-top:15px;">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©:</label>
        <input type="text" id="newP" placeholder="Ø±Ø§Ø¨Ø· URL">
        
        <label style="display:block; margin-top:15px;">Ø®Ù„ÙÙŠØ© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© (Ø±Ø§Ø¨Ø·):</label>
        <input type="text" id="newWall" placeholder="Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©">
        
        <label style="display:block; margin-top:15px;">Ø«ÙŠÙ… Ø§Ù„Ø£Ù„ÙˆØ§Ù†:</label>
        <select id="newT">
            <option value="default">ğŸ”µ Ø¯ÙŠÙÙˆÙ„Øª (Ø¯Ø§ÙƒÙ†)</option>
            <option value="white">âšª Ø£Ø¨ÙŠØ¶ (Ù†Ù‡Ø§Ø±)</option>
            <option value="purple">ğŸŸ£ Ø¨Ù†ÙØ³Ø¬ÙŠ</option>
            <option value="gold">ğŸ‘‘ Ø°Ù‡Ø¨ÙŠ Ù…Ù„ÙƒÙŠ</option>
            <option value="red">ğŸ”´ Ø£Ø­Ù…Ø± Ø¯ÙŠØ¨</option>
            <option value="black">âš« Ø£Ø³ÙˆØ¯ ÙØ®Ù…</option>
        </select>
        
        <label style="display:block; margin-top:15px;">ØªØºÙŠÙŠØ± Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„:</label>
        <input type="password" id="newPass" placeholder="Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¬Ø¯ÙŠØ¯">
        
        <div style="display:flex; gap:10px; margin-top:25px;">
            <button onclick="saveSettings()" style="background:var(--accent); color:white; border:none; padding:12px; flex:1; border-radius:10px; font-weight:bold; cursor:pointer;">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
            <button onclick="closeSettings()" style="background:rgba(255,255,255,0.1); color:var(--text); border:none; padding:12px; flex:1; border-radius:10px; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>
</div>

<button id="toggleBtn" class="toggle-btn" style="display:none;" onclick="toggleSidebar()">â˜°</button>

<div class="sidebar" id="sidebar">
    <div style="padding:25px; text-align:center; border-bottom:1px solid rgba(0,0,0,0.1);">
        <img id="myPfp" src="" class="avatar" style="width:65px; height:65px;">
        <div id="myName" style="font-weight:900; margin-top:8px; font-size:1.1rem;"></div>
        <button onclick="openSettings()" style="background:none; border:1px solid var(--accent); color:var(--accent); font-size:0.75rem; padding:5px 15px; border-radius:20px; margin-top:8px; cursor:pointer; font-weight:bold;">âš™ï¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
    </div>

    <div style="flex:1; overflow-y:auto; padding:15px;">
        <div id="friendsList"></div>
        
        <div style="background:rgba(0,0,0,0.1); margin-top:15px; padding:12px; border-radius:15px; border:1px dashed var(--accent);">
            <button onclick="document.getElementById('fastUpload').click()" style="background:#43b581; color:white; border:none; width:100%; padding:10px; border-radius:10px; cursor:pointer; font-weight:bold;">ğŸ“¤ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ø§Ø¨Ø· Ù…Ù„Ù</button>
            <input type="file" id="fastUpload" style="display:none" onchange="generateLink(this)">
            <div id="linkResult" style="display:none; margin-top:10px;">
                <input type="text" id="theLinkText" readonly style="font-size:0.65rem;">
                <button onclick="copyLink()" style="background:var(--accent); color:white; border:none; width:100%; padding:8px; border-radius:8px; margin-top:5px; font-size:0.8rem; font-weight:bold;">Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø·</button>
            </div>
        </div>
    </div>

    <div style="padding:20px; border-top:1px solid rgba(0,0,0,0.1);">
        <input type="text" id="addID" placeholder="ID Ø§Ù„ØµØ¯ÙŠÙ‚">
        <button onclick="addNewFriend()" style="background:var(--accent); color:white; border:none; width:100%; padding:10px; border-radius:10px; margin-top:8px; font-weight:bold;">Ø¥Ø¶Ø§ÙØ©</button>
    </div>
</div>

<div class="main-content">
    <div id="chatWall"></div>
    <div id="messages"></div>
    <div class="input-bar">
        <input type="text" id="msgIn" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ø£Ùˆ Ø§Ù„ØµÙ‚ Ø±Ø§Ø¨Ø·Ø§Ù‹..." onkeypress="if(event.key==='Enter') send()">
        <button onclick="send()" style="background:var(--accent); color:white; border:none; padding:0 25px; border-radius:12px; font-weight:bold;">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<script>
    // 1. ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… ÙÙˆØ±Ø§Ù‹ Ù‚Ø¨Ù„ Ø£ÙŠ Ø´ÙŠØ¡
    function applySettings() {
        const theme = localStorage.getItem('zain_theme') || 'default';
        const themes = {
            default: { bg: "#313338", side: "#2b2d31", accent: "#5865f2", text: "#dbdee1", msg: "#383a40" },
            white: { bg: "#f0f2f5", side: "#ffffff", accent: "#007bff", text: "#1c1e21", msg: "#e4e6eb" },
            gold: { bg: "#1a1a1a", side: "#262626", accent: "#d4af37", text: "#f2f2f2", msg: "#333333" },
            purple: { bg: "#1e0b36", side: "#2d134d", accent: "#9d50bb", text: "#efdaff", msg: "#3c1b66" },
            red: { bg: "#2b0505", side: "#3d0808", accent: "#ff4b2b", text: "#ffebeb", msg: "#5c0c0c" },
            black: { bg: "#000000", side: "#0a0a0a", accent: "#ffffff", text: "#ffffff", msg: "#1a1a1a" }
        };
        const t = themes[theme] || themes.default;
        const r = document.documentElement;
        r.style.setProperty('--bg', t.bg); r.style.setProperty('--side', t.side);
        r.style.setProperty('--accent', t.accent); r.style.setProperty('--text', t.text);
        r.style.setProperty('--msg-bg', t.msg);

        const wall = localStorage.getItem('zain_wall');
        if(wall) document.getElementById('chatWall').style.backgroundImage = `url(${wall})`;
    }
    applySettings(); // ØªÙ†ÙÙŠØ° ÙÙˆØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„

    const OWNER_KEY = "zain";
    let pubnub, myID = localStorage.getItem('zain_id') || Math.floor(Math.random()*8999)+1000;
    localStorage.setItem('zain_id', myID);
    let friends = JSON.parse(localStorage.getItem('my_friends_v2') || "[]"), currentFid = null;

    function unlock() {
        const pass = localStorage.getItem('my_pass') || "123";
        if(document.getElementById('passInput').value !== pass) return alert("Ø§Ù„Ø±Ù…Ø² ØºÙŠØ± ØµØ­ÙŠØ­!");
        document.getElementById('lockScreen').style.display = 'none';
        document.getElementById('toggleBtn').style.display = 'flex';
        initPN(); loadUI(); renderFriends();
    }

    function initPN() {
        pubnub = new PubNub({ publishKey: "pub-c-90243370-fb67-4c9c-914f-77acbcade771", subscribeKey: "sub-c-bc8811a4-c349-4df5-8896-9a7cf29ad727", uuid: myID.toString(), fileUpload: true });
        pubnub.addListener({ message: (m) => { if(m.channel.includes(currentFid)) renderMsg(m.message); } });
        friends.forEach(f => pubnub.subscribe({ channels: ["v8_chat_" + [myID, f.id].sort().join("_")] }));
    }

    function openSettings() {
        document.getElementById('newN').value = localStorage.getItem('zain_name') || "";
        document.getElementById('newP').value = localStorage.getItem('zain_pic') || "";
        document.getElementById('newWall').value = localStorage.getItem('zain_wall') || "";
        document.getElementById('newT').value = localStorage.getItem('zain_theme') || "default";
        document.getElementById('newPass').value = localStorage.getItem('my_pass') || "123";
        document.getElementById('settingsModal').style.display = 'flex';
    }

    function closeSettings() { document.getElementById('settingsModal').style.display = 'none'; }

    function saveSettings() {
        localStorage.setItem('zain_name', document.getElementById('newN').value);
        localStorage.setItem('zain_pic', document.getElementById('newP').value);
        localStorage.setItem('zain_wall', document.getElementById('newWall').value);
        localStorage.setItem('zain_theme', document.getElementById('newT').value);
        localStorage.setItem('my_pass', document.getElementById('newPass').value);
        location.reload();
    }

    function renderMsg(data) {
        if(!data.uid) return;
        const box = document.getElementById('messages'), isMine = data.uid == myID, div = document.createElement('div');
        div.className = `msg ${isMine ? 'mine' : ''}`;
        let content = data.text || "";
        if(content.match(/\.(jpg|jpeg|png|gif|webp)/i)) content = `<img src="${content}" onclick="window.open(this.src)">`;
        else if(content.match(/\.(mp4|mov|webm)/i)) content = `<video controls src="${content}"></video>`;
        div.innerHTML = `<img src="${data.pic}" class="avatar" style="width:35px; height:35px;"><div style="flex:1;"><div style="font-size:0.65rem; opacity:0.7; font-weight:bold;">${data.name}</div><div>${content}</div></div>`;
        box.appendChild(div); box.scrollTop = box.scrollHeight;
    }

    function openChat(id) {
        currentFid = id; renderFriends(); document.getElementById('messages').innerHTML = "";
        if(window.innerWidth < 600) toggleSidebar();
        const chan = "v8_chat_" + [myID, id].sort().join("_");
        pubnub.fetchMessages({ channels: [chan], count: 50 }, (s, res) => {
            if (res && res.channels[chan]) res.channels[chan].forEach(m => renderMsg(m.message));
        });
    }

    function renderFriends() {
        const list = document.getElementById('friendsList'); list.innerHTML = "";
        friends.forEach(f => {
            const div = document.createElement('div'); div.className = `friend-card ${currentFid == f.id ? 'active' : ''}`;
            div.innerHTML = `
                <img src="https://www.gravatar.com/avatar/${f.id}?d=identicon" class="avatar" style="width:30px; height:30px;">
                <span style="font-weight:bold; font-size:0.9rem;">${f.name}</span>
                <div style="margin-right:auto; display:flex; gap:10px;">
                    <span class="tool-btn" onclick="editFriend('${f.id}', event)">âœï¸</span>
                    <span class="tool-btn" onclick="removeFriend('${f.id}', event)" style="color:#ed4245">âœ•</span>
                </div>`;
            div.onclick = () => openChat(f.id); list.appendChild(div);
        });
    }

    function editFriend(id, e) {
        e.stopPropagation();
        const f = friends.find(x => x.id == id);
        const newN = prompt("ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ØµØ¯ÙŠÙ‚:", f.name);
        if(newN) { f.name = newN; localStorage.setItem('my_friends_v2', JSON.stringify(friends)); renderFriends(); }
    }

    function removeFriend(id, e) {
        e.stopPropagation();
        if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØµØ¯ÙŠÙ‚ØŸ")) { friends = friends.filter(x => x.id != id); localStorage.setItem('my_friends_v2', JSON.stringify(friends)); renderFriends(); }
    }

    function send() {
        const inp = document.getElementById('msgIn'); if(!inp.value.trim() || !currentFid) return;
        pubnub.publish({ channel: "v8_chat_" + [myID, currentFid].sort().join("_"), message: { text: inp.value, uid: myID, name: document.getElementById('myName').innerText, pic: document.getElementById('myPfp').src } });
        inp.value = "";
    }

    async function generateLink(input) {
        const file = input.files[0]; if(!file) return;
        try {
            const up = await pubnub.sendFile({ channel: "vault_" + myID, file: file });
            const url = pubnub.getFileUrl({ channel: "vault_" + myID, id: up.id, name: up.name });
            document.getElementById('theLinkText').value = url;
            document.getElementById('linkResult').style.display = 'block';
        } catch(e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø±Ø§Ø¨Ø·"); }
    }

    function copyLink() { document.getElementById('theLinkText').select(); document.execCommand('copy'); alert("ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· Ø¨Ù†Ø¬Ø§Ø­!"); }

    function loadUI() {
        document.getElementById('myName').innerText = localStorage.getItem('zain_name') || "Ù…Ø³ØªØ®Ø¯Ù… #" + myID;
        document.getElementById('myPfp').src = localStorage.getItem('zain_pic') || "https://www.gravatar.com/avatar/" + myID + "?d=identicon";
    }

    function addNewFriend() {
        const id = document.getElementById('addID').value.trim();
        if(id && id != myID) {
            const name = prompt("Ø§Ø³Ù… Ø§Ù„ØµØ¯ÙŠÙ‚ØŸ") || "ØµØ¯ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯";
            friends.push({id, name}); localStorage.setItem('my_friends_v2', JSON.stringify(friends)); renderFriends();
            document.getElementById('addID').value = "";
        }
    }
    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('hidden'); }
</script>
</body>
</html>
